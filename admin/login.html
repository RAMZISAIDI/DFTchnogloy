<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>تسجيل الدخول - DF Technology</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Cairo',sans-serif;}
:root{--bg:#0a0e27;--card:#151b3d;--acc:#00d9ff;--acc2:#7c3aed;--brd:#1e2951;--grad:linear-gradient(135deg,#00d9ff,#7c3aed);}
body{background:var(--bg);min-height:100vh;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;}
.orb{position:absolute;border-radius:50%;filter:blur(90px);opacity:.12;}
.orb1{width:420px;height:420px;background:#00d9ff;top:-130px;right:-130px;}
.orb2{width:300px;height:300px;background:#7c3aed;bottom:-90px;left:-90px;}
body::before{content:'';position:absolute;inset:0;background-image:linear-gradient(rgba(0,217,255,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,217,255,.03) 1px,transparent 1px);background-size:50px 50px;}
.wrap{position:relative;z-index:10;width:100%;max-width:420px;padding:18px;}
.card{background:rgba(21,27,61,.9);backdrop-filter:blur(20px);border:1px solid rgba(0,217,255,.18);border-radius:22px;padding:44px 36px;box-shadow:0 24px 70px rgba(0,0,0,.5);}
.top{text-align:center;margin-bottom:32px;}
.ico{width:72px;height:72px;border-radius:16px;background:var(--grad);display:inline-flex;align-items:center;justify-content:center;font-size:1.75rem;color:#fff;margin-bottom:13px;box-shadow:0 8px 26px rgba(0,217,255,.32);}
.tit{font-size:1.65rem;font-weight:900;color:#fff;}
.tit span{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.sub{color:#64748b;font-size:.86rem;margin-top:4px;}
.fg{margin-bottom:17px;}
.fg label{display:block;color:#94a3b8;font-size:.84rem;font-weight:600;margin-bottom:6px;}
.iw{position:relative;}
.ii{position:absolute;right:14px;top:50%;transform:translateY(-50%);color:#475569;font-size:.92rem;pointer-events:none;}
.fc{width:100%;padding:12px 42px 12px 42px;background:rgba(10,14,39,.8);border:1px solid var(--brd);color:#fff;border-radius:10px;font-size:.95rem;font-family:inherit;transition:.25s;}
.fc:focus{outline:none;border-color:var(--acc);box-shadow:0 0 0 3px rgba(0,217,255,.1);}
.fc::placeholder{color:#334155;}
.eye-btn{position:absolute;left:13px;top:50%;transform:translateY(-50%);background:none;border:none;color:#475569;cursor:pointer;font-size:.92rem;transition:.2s;}
.eye-btn:hover{color:var(--acc);}
.err{display:none;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.28);color:#f87171;padding:11px 14px;border-radius:9px;font-size:.85rem;margin-bottom:16px;align-items:center;gap:9px;}
.err.on{display:flex;}
.btn{width:100%;padding:14px;background:var(--grad);color:#fff;border:none;border-radius:10px;font-size:.98rem;font-weight:800;cursor:pointer;transition:.28s;font-family:inherit;}
.btn:hover{transform:translateY(-2px);box-shadow:0 13px 34px rgba(0,217,255,.38);}
.btn:disabled{opacity:.55;cursor:not-allowed;transform:none;}
.spin{display:none;width:18px;height:18px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:sp .8s linear infinite;margin:0 auto;}
@keyframes sp{to{transform:rotate(360deg)}}
.att{text-align:center;margin-top:11px;color:#ef4444;font-size:.8rem;display:none;}
.hint{text-align:center;margin-top:20px;color:#475569;font-size:.79rem;line-height:1.7;}
.hint strong{color:#64748b;}
@keyframes shk{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-7px)}40%,80%{transform:translateX(7px)}}
</style>
</head>
<body>
<div class="orb orb1"></div><div class="orb orb2"></div>
<div class="wrap">
  <div class="card" id="card">
    <div class="top">
      <div class="ico"><i class="fas fa-lock"></i></div>
      <div class="tit">DF <span>Technology</span></div>
      <div class="sub">لوحة التحكم — دخول آمن</div>
    </div>
    <div class="err" id="errBox"><i class="fas fa-exclamation-circle"></i><span id="errTxt">بيانات خاطئة</span></div>
    <form onsubmit="doLogin(event)">
      <div class="fg"><label>اسم المستخدم</label>
        <div class="iw"><i class="fas fa-user ii"></i>
          <input class="fc" id="usr" type="text" placeholder="admin" autocomplete="username" required>
        </div>
      </div>
      <div class="fg"><label>كلمة المرور</label>
        <div class="iw"><i class="fas fa-lock ii"></i>
          <input class="fc" id="pwd" type="password" placeholder="••••••••" autocomplete="current-password" required>
          <button type="button" class="eye-btn" onclick="toggleEye()"><i id="eyeI" class="fas fa-eye"></i></button>
        </div>
      </div>
      <button class="btn" id="lBtn">
        <span id="lTxt"><i class="fas fa-sign-in-alt" style="margin-left:8px"></i>دخول</span>
        <div class="spin" id="sp"></div>
      </button>
    </form>
    <div class="att" id="attBox"></div>
    <div class="hint"><strong>الحساب الافتراضي:</strong> admin / DFtech2026<br>قابل للتغيير من الإعدادات</div>
  </div>
</div>
<script src="../js/db.js"></script>
<script>
// Redirect if already logged in
const sess = sessionStorage.getItem('dft_admin');
if (sess) { try { if (JSON.parse(sess).exp > Date.now()) window.location.href = 'index.html'; } catch{} }

let tries = 0;

function toggleEye() {
  const i = document.getElementById('pwd'), ic = document.getElementById('eyeI');
  i.type = i.type === 'password' ? 'text' : 'password';
  ic.className = i.type === 'text' ? 'fas fa-eye-slash' : 'fas fa-eye';
}

function doLogin(e) {
  e.preventDefault();
  if (tries >= 5) return;
  const u = document.getElementById('usr').value.trim();
  const p = document.getElementById('pwd').value;
  const btn = document.getElementById('lBtn'), txt = document.getElementById('lTxt'), sp = document.getElementById('sp');
  btn.disabled = true; txt.style.display = 'none'; sp.style.display = 'block';

  setTimeout(async () => {
    // Get admin credentials from DB settings
    const cfg = await DB.getSettings().catch(() => ({}));
    const validUser = cfg.adminUser || 'admin';
    const validPass = cfg.adminPass || 'DFtech2026';

    if (u === validUser && p === validPass) {
      sessionStorage.setItem('dft_admin', JSON.stringify({ exp: Date.now() + 8*3600000, user: u }));
      window.location.href = 'index.html';
      return;
    }

    tries++;
    btn.disabled = false; txt.style.display = 'block'; sp.style.display = 'none';
    const eb = document.getElementById('errBox'), et = document.getElementById('errTxt'), ab = document.getElementById('attBox');

    if (tries >= 5) {
      et.textContent = 'تم تجاوز المحاولات. انتظر دقيقتين.';
      btn.disabled = true; ab.style.display = 'none';
      setTimeout(() => { tries = 0; btn.disabled = false; eb.classList.remove('on'); }, 120000);
    } else {
      et.textContent = 'اسم المستخدم أو كلمة المرور غير صحيحة';
      ab.style.display = 'block'; ab.textContent = `تبقى ${5 - tries} محاولة`;
    }
    eb.classList.add('on');
    document.getElementById('card').style.animation = 'shk .45s ease';
    setTimeout(() => document.getElementById('card').style.animation = '', 500);
  }, 700);
}
</script>
</body>
</html>
